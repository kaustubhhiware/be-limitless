function testIndexedDB(){}function processScratchpad(){setScratchpad($("#scratchpad").val());var e=$("#scratchpad").val();if(-1!=e.indexOf("Countdown:")&&(e=e.replace("Countdown","Remind me")),clearCalendarandTodo(),-1!=e.toLowerCase().indexOf("remind me: ")){re=/Remind me/gi;today||(today=new Date);for(var t=Math.round(today.getTime()/1e3);match=re.exec(e);){var o=e.substr(match.index+10,e.length).replace(/\r\n/g,"\n").split("\n");o[0]=o[0].replace(" at "," on ");var a=o[0].split("on"),n=a[0].trim(),i=Math.round(Date.parse(a[1])/1e3);i>0&&n.length>0&&n.length<100&&i>t&&addCalendarEvent(i,n)}}if(-1!=e.toLowerCase().indexOf("todo: "))for(re=/TODO/gi;match=re.exec(e);){var r=e.substr(match.index+5,e.length).replace(/\r\n/g,"\n").split("\n");addTodo(r[0].substr(0,50).trim())}$("#temp").html(""),$("#temp").append("<li>"+getWeatherInfo()+"</li>");var t=Math.round(today.getTime()/1e3);$("#temp").append("<li>"+getNextEvent(t)+"</li>"),$("#temp").append("<li>"+getNextTodo()+"</li>")}function hideallscreens(){$("#firstscreen").hide(),$("#dailygoalscreen").hide(),$("#detailscreen").hide(),$("#settingscreen").hide(),$("#sharescreen").hide(),$("#analyticsscreen").hide(),$("#stuffscreen").hide(),$("#emailComposeScreen").hide(),stuffscreenClosed(),$("#productivityscreen").hide(),TopSiteAnalytics.hide(),$("#topsites").hide(),$("#countdowntimerscreen").hide(),$("#walkthrough").hide(),$("#topsitesscreen").hide(),$("#clearStatsConfirmationScreen").hide(),ScreenOverlay.setAsImageScreen()}function showClearStatsConfirmationScreen(){$("#clearStatsConfirmationScreen").show()}function setupFirstScreen(){hideallscreens(),ScreenOverlay.setAsContentScreen(),$("#topicons").hide(),$("#firstscreen").show(),$("#footer").hide(),$("#optionpanel").hide(),$("#walkthrough .icon-next").click(function(){walkthroughstage<7&&(walkthroughstage++,walkThrough())}),$("#walkthrough .icon-prev").click(function(){walkthroughstage>1&&(walkthroughstage--,walkThrough())})}function walkThrough(){$(".maincontainer").hide(),walkthroughstage<7?$("#walkthrough .icon-next").show():$("#walkthrough .icon-next").hide(),walkthroughstage>1?$("#walkthrough .icon-prev").show():$("#walkthrough .icon-prev").hide();var e="../images/walkthrough/Walkthrough"+walkthroughstage+".jpg",t="";t=7!=walkthroughstage?"<h4>Limitless: "+walkthroughstage+'/7  <a href="#"><span id="skipwalkthrough">Skip</span></a>  </h4>':"<h4>Limitless walkthrough "+walkthroughstage+"/7  </h4>",$("#walkthroughstage").html(t+'<img src="'+e+'"/>'),$("#walkthrough").show(),$("#skipwalkthrough").click(function(){walkthroughstage=7,walkThrough()})}function ShowScratchPad(){hideallscreens(),$("#scratchpad").val(getScratchpad()),$("#stuffscreen").show()}function showEmailCompose(){hideallscreens(),$("#emailComposeScreen").show()}function setupTopSitesScreen(){var e=document.getElementById("topsitestable"),t=document.createElement("thead");e.appendChild(t),t.innerhtml="<th>Site URL</th><th>Short name</th>";var o=document.createElement("tbody");e.appendChild(o);for(var a=getTopSitesData(),n=0;n<10&&n<a.length;n++){var i=a[n][0],r=capitaliseFirstLetter(i).substring(0,8),s=r.substring(0,2),c=s;row=document.createElement("tr"),cell=document.createElement("td"),cell.innerHTML='<input type="text" value = "'+i+'" class="editbox"/>',row.appendChild(cell),cell=document.createElement("td"),cell.innerHTML='<input type="text" value = "'+c+'" class="shortnamebox"/>',row.appendChild(cell),o.appendChild(row)}hideallscreens(),$("#topsitesscreen").show()}function setupDailyScreen(){setGoalSetToday(),setupData(),showTopSites(),$("#rememberannualgoal").html("My goal for the year: <i>"+getAnnualGoal()+"</i>"),""==getDailyGoal()?$(".dailygoalinput").attr("placeholder","Goal for today: "):$(".dailygoalinput").val(getDailyGoal()),hideallscreens(),$("#dailygoalscreen").show(),$("#topsites").show()}function setupSettingScreen(){var e=$("#updateSettingsForm");e.find("[name=name]").val(LLPrivateStorage.get("name")),e.find("[name=email]").val(LLPrivateStorage.get("email")),e.find("[name=goal]").val(LLPrivateStorage.get("goal")),hideallscreens(),ScreenOverlay.setAsContentScreen(),$("#settingscreen").show()}function setupShareScreen(){hideallscreens(),ScreenOverlay.setAsContentScreen(),$("#sharescreen").show()}function setupHome(){hideallscreens(),setupData(),showTopSites(),addmessage(),$("#topicons").show(),$("#topsites").show(),$("#productivityscreen").show(),TopSiteAnalytics.show()}function setupTimerScreen(){setupData(),hideallscreens();today||(today=new Date);var e=Math.round(today.getTime()/1e3),t=getNextEventName(e);if(""!=t)$("#timer").html("<h1>"+timeBetweenElaborate(e,getNextEventTime(e))+"</h1>"),$("#timemessage").html("Time left for: "+t.substring(0,50));else{var o=60*minsToMidnight();if(o>1e3){var a=Math.floor(o/1e3);$("#timer").html("<h1>"+a+",000 </h1>")}else $("#timer").html("<h1>"+o+"</h1>");var n=LLPrivateStorage.get("name"),i=" This is the number of seconds left in the day. Do something awesome, "+n+".";$("#timemessage").html(i)}showTopSites(),$("#topsites").show(),$("#countdowntimerscreen").show()}function setupCategories(){setupData(),$("#allcategories").empty(),table=document.getElementById("allcategories"),tbody=document.createElement("tbody"),table.appendChild(tbody),max=20;for(var e=0;e<sortedSites.length&&e<max;e++){e%5==0&&(row=document.createElement("tr"),tbody.appendChild(row));var t=sortedSites[e][0];totalTime[t]||(totalTime[t]=0);var o=formatTime(totalTime[t])+" ("+Math.floor(100*totalTime[t]/totalTimeAll)+"%)";cell=document.createElement("td"),cell.innerHTML='<h2 id="detailedcategory'+e+'">'+t+"</h2>"+o,row.appendChild(cell),$("#detailedcategory"+e).click(function(){state="analyticsscreen",detailedanalytics($(this).text()),hideallscreens(),$("#detailscreen").show()})}}function detailedanalytics(e){$("#stats").empty(),$("#editcategories").show(),$("#editssave").hide();var t="<h2>Total time spent on "+e+": "+formatTime(totalTime[e])+"</h2>";if($("#totaltime").html(t),0!=totalTime[e]){sortedSites=[];var o=JSON.parse(localStorage.donttrack);for(var a in timeanalytics)if(!o[a]&&"newtab"!=a){if(timeanalytics[a][dateString]&&"today"==localStorage.dateoption)timeanalytics[a][dateString]=parseInt(timeanalytics[a][dateString]);else if("today"==localStorage.dateoption)continue;var n=0;if("all"==localStorage.dateoption)for(var i in timeanalytics[a])isNaN(timeanalytics[a][i])||(n+=parseInt(timeanalytics[a][i]));else n=timeanalytics[a][dateString];for(var r=timeanalytics[a].category.split(","),s=0;s<r.length;s++){var c=r[s].trim();c==e&&sortedSites.push([a,n])}}sortedSites.sort(function(e,t){return e=e[1],t=t[1],e>t?-1:e<t?1:0});var l=document.getElementById("stats"),d=document.createElement("thead");l.appendChild(d),row=document.createElement("tr"),th=document.createElement("th"),th.innerHTML="Domain",row.appendChild(th),th=document.createElement("th"),th.innerHTML="Time Spent",row.appendChild(th),th=document.createElement("th"),th.innerHTML="% of total",row.appendChild(th),d.appendChild(row);var u=document.createElement("tbody");l.appendChild(u);for(var h=0;h<sortedSites.length&&h<10;h++){var a=sortedSites[h][0];row=document.createElement("tr"),cell=document.createElement("td"),cell.innerHTML='<a href="http://'+a+'">'+a+"</a>",row.appendChild(cell);var p=sortedSites[h][1];cell=document.createElement("td"),cell.appendChild(document.createTextNode(formatTime(p))),row.appendChild(cell),cell=document.createElement("td"),cell.innerHTML=Math.ceil(100*sortedSites[h][1]/totalTime[e]),row.appendChild(cell),u.appendChild(row)}setStatsTableHeight(),$(window).bind("mousewheel DOMMouseScroll",function(e){var t=window.event||e;return(t.detail?-120*t.detail:t.wheelDelta)<0?$("#statstable").scrollTop($("#statstable").scrollTop()+20):$("#statstable").scrollTop($("#statstable").scrollTop()-20),!0})}}function showTopSites(){if($("#topsites").empty(),alltopSites=getTopSitesData(),1==getTopSitesShow()||alltopSites.length<2)return table=document.getElementById("topsites"),tbody=document.createElement("tbody"),table.appendChild(tbody),row=document.createElement("tr"),tbody.appendChild(row),cell=document.createElement("td"),cell.innerHTML='<a href="#" id="notepadclick"><div data-aid="NotepadIcon" class="icon-notepad"></div><h4 data-aid="NotepadIcon">Notepad</h4></a>',alltopSites.length>=2&&(cell.innerHTML+='<a href="#" data-aid="showTopSites" id="setuptopsites">Show my top sites </a>'),row.appendChild(cell),$("#notepadclick").click(function(){hideallscreens(),$("#scratchpad").val(getScratchpad()),$("#stuffscreen").show(),stuffscreenShown()}),$("#setuptopsites").click(function(){$("#topsites").empty(),setShowTopSites(),showTopSites()}),void $("#topsites").show();maxsites=6,parseInt($(window).width())>1200?maxsites=8:$(window).width()<800&&(maxsites=4);table=document.getElementById("topsites"),tbody=document.createElement("tbody"),row=document.createElement("tr"),tbody.appendChild(row);var e=Math.min(alltopSites.length,maxsites);e%2==1&&(e-=1);for(var t=0;t<e;t++){t==Math.round(e/2)&&(cell=document.createElement("td"),cell.innerHTML='<a href="#" id="notepadclick"><div data-aid="NotepadIcon" class="icon-notepad"></div><h4 data-aid="NotepadIcon">Notepad</h4></a>',cell.innerHTML+='<a href="#" data-aid="HideTopSites" id="edittopsites">Hide top sites </a>',row.appendChild(cell),$("#notepadclick").click(function(){hideallscreens(),$("#scratchpad").val(getScratchpad()),$("#stuffscreen").show(),stuffscreenShown()}),$("#edittopsites").click(function(){$("#topsites").empty(),setHideTopSites(),showTopSites()}));var o=alltopSites[t][0],a="http://"+o,n=capitaliseFirstLetter(getSuperdomain(alltopSites[t][0])).substring(0,8),i=n.substring(0,2);timedisp=formatTime(alltopSites[t][1]),cell=document.createElement("td"),cell.innerHTML='<a href="'+a+'"><h4>'+n+"</h4><h2>"+i+"</h2><h4>"+timedisp+"</h4></a>",row.appendChild(cell)}$("#topsites").show()}function findmaxproductivity(){var e=JSON.parse(localStorage.productivity),t=[],o=0,a=[];if("all"==localStorage.dateoption){for(var n in e)for(var i in e[n])a[i]?(a[i].productive+=e[n][i].productive,a[i].timespent+=e[n][i].timespent):(a[i]=[],a[i].productive=e[n][i].productive,a[i].timespent=e[n][i].timespent);for(var i in a){var r=Math.floor(100*a[i].productive/a[i].timespent);t.push([i,r]),o+=a[i].timespent}}else for(var s in e[dateString]){var r=Math.floor(100*e[dateString][s].productive/e[dateString][s].timespent);t.push([s,r]),o+=e[dateString][s].timespent}if(0<t.length){t.sort(function(e,t){return e=e[1],t=t[1],e>t?-1:e<t?1:0});var c=parseInt(t[0][0]),l="Your best productive time today so far is between "+getHourDisplay(c)+" - "+getHourDisplay(c+1)+" with a productive browsing of "+t[0][1]+"%";$("#productivity").html(l)}}function setEditCategories(){$("#editcategories").hide(),$("#editssave").show();var e=0;$("#stats").find("tr").each(function(){var t=$(this);if(0==e)t.append("<th>Category name</th><th>Productive ?</th>");else{var o=$(this).find("td").eq(0).text(),a=timeanalytics[o].category,n=parseInt(timeanalytics[o].productive);checked=n?"checked":"",t.append('<td><input type="text" name="cb" value = "'+a+'" class="editbox '+o+'"/></td><td><input class="productivitycheck '+o+'" type="checkbox" '+checked+" /></td>")}e++}),$(".editbox").change(function(e){var t=$(e.target).attr("class").replace("editbox ","");""!==$(e.target).val()&&(timeanalytics[t].category=capitaliseFirstLetter($(e.target).val())),localStorage.timeanalytics=JSON.stringify(timeanalytics),setupCategories()}),$(".productivitycheck").change(function(){var e=$(event.target).attr("class").replace("productivitycheck ","");$(this).is(":checked")?timeanalytics[e].productive=1:timeanalytics[e].productive=0,localStorage.timeanalytics=JSON.stringify(timeanalytics),setupCategories()})}function setStatsTableHeight(){var e=$(window).height()-$("#statstable").offset().top;$("#statstable").css("height",e+"px")}function setupEventHandlers(){$("#firstStepOnboardingForm").submit(function(e){e.preventDefault();var t=$("[name=onboardingNameInput]").val();LLPrivateStorage.set({name:t}),$("#onboardingFirstStepContainer").hide(),$("#onboardingGoogleStepContainer").show(),doneFirst()}),$(".skipGoogleStep").click(function(e){e.preventDefault(),$("#onboardingFirstStepContainer").hide(),$("#onboardingGoogleStepContainer").hide(),$("#onboardingSecondStepContainer").show()}),$("#secondStepOnboardingForm").submit(function(e){e.preventDefault();var t=$("[name=onboardingEmailInput]").val();LLPrivateStorage.set({email:t}),setupHome()}),$("#gohome, .goHomeLink").click(function(){setupHome()}),$("#clearstats").click(function(){hideallscreens(),ScreenOverlay.setAsContentScreen(),showClearStatsConfirmationScreen()}),$("#confirm-clear-stats-button").click(function(){confirm("You can not recover the stats again! Are you sure to delete?")&&(localStorage.timeanalytics=JSON.stringify({}),localStorage.productivity=JSON.stringify({})),setupHome()}),$("#backfromdetails").click(function(){setupCategories(),hideallscreens(),$("#analyticsscreen").show()}),$("#backtoanalytics").click(function(){hideallscreens(),$("#categoryscreen").show()}),$(".defaulttab").click(function(){chrome.tabs.update({url:"chrome://apps"})}),$(".premiumlink").click(function(){Analytics.showWeeklyPage()}),$("#updatesettings").click(function(){var e=$("#updateSettingsForm"),t={name:e.find("[name=name]").val(),email:e.find("[name=email]").val(),goal:e.find("[name=goal]").val()};LLPrivateStorage.set(t),setupHome()}),$("#settingslink, .gotoSettings").click(function(){setupSettingScreen()}),$("#sharelink").click(function(){setupShareScreen()}),$("#scratchpad").change(function(){processScratchpad()}),$("#scratchpad").keyup(function(e){13==e.which&&processScratchpad()}),$("#sendnotepad").click(function(){showEmailCompose(),$("#composeEmailForm textarea[name=body]").val(getScratchpad())}),$(".dailygoalinput").change(function(){setDailyGoal($(this).val())}),$("#editcategories").click(function(){setEditCategories()}),$(window).resize(function(){setStatsTableHeight()}),Analytics.init(),Authentication.init(),Authentication.handleLoginViews(),Premium.init(),ToDo.init(),Emails.init(),$('[data-toggle="tooltip"]').tooltip(),$("body").on("click",'[data-toggle="tooltip"]',function(){$(this).tooltip("hide")}),$("body").on("click",".addmessageLink",function(){addmessage()}),$("body").on("click",".markReviewDone",function(){TriggerStorage.markShowGlobal("review_app")}),$("body").on("click",".spext-icon",function(){TriggerStorage.markShowGlobal("login_spext",20);var e=Util.getGuid();document.location.href="https://spext.co/#/?limitless_id="+e}),$("body").on("click","#learnMore",function(){TriggerStorage.markShowGlobal("login_spext",20);var e=Util.getGuid();document.location.href="https://spext.co/#/?limitless_id="+e}),$("body").on("click","#whyAreWeWorkingOnThis",function(){$("#myModal").modal("show")}),$("body").on("click",".close-notepad-icon",function(){setupHome()}),$("body").on("keyup",".input-enter-goal-after",function(e){var t=$(".input-enter-goal-after").val();LLPrivateStorage.set({goal:t}),13==e.keyCode&&$(this).blur()})}function stuffscreenShown(){$("#todosList").addClass("notepad-open")}function stuffscreenClosed(){$("#todosList").removeClass("notepad-open")}function myRandom(e,t,o){var a=JSON.parse(localStorage.randomNumber)||1,n=a+e,i=isFestiveDay();return i[0]&&o&&"nature"==t?(console.log("Festival Today"),i[1]+1e3):o&&"nature"==t?n%Util.NATURE_WALLPAPERS_ONLINE+1:o?n%Util.TRIGGER_WALLPAPERS_ONLINE+1:n%Util.NUMBER_OF_WALLPAPERS+1}function getImageXHR(e,t,o){var a=new XMLHttpRequest;url=urlBuilder(e,t),a.open("GET",url),a.responseType="arraybuffer",a.onreadystatechange=function(){4==a.readyState&&(200===a.status?(console.log("REAL BLOB"),console.log(a.response),o(e,t,a.response)):console.log("Failed to Get Image, err:"+a.status))},a.send()}function getImageBlobUtil(e,t,o){(new Image).src=urlBuilder(e,t),blobUtil.imgSrcToBlob(src,"image/jpeg","Anonymous",1).then(function(a){o(e,t,a)}).catch(function(e){console.log("imgSrcToBlob Err: "+e)})}function addToPouchDB(e,t,o){db.get(e).catch(function(t){if("not_found"===t.name)return{_id:e};throw t}).then(function(a){console.log("PouchDB: Updating Image for "+e),db.putAttachment(e,e+".jpg",a._rev,o,"image/jpeg").then(function(){localStorage["imgUpdated/"+e]=t}).catch(function(e){throw e})}).catch(function(e){console.log("PouchDB addToPouchDB Err: "+e)})}function addToFileSystem(e,t,o){file_system.root.getFile(e,{create:!0},function(a){a.createWriter(function(a){a.onwriteend=function(e){console.log("Write successfully")},a.onerror=function(e){console.log("Write error!")},a.write(o),localStorage["imgUpdated/"+e]=t})})}function addToChromeStorage(e,t,o){node={},image={},image.blob=o,image.updatedDate=t,node[e]=image,chrome.storage.local.set(node),console.log("Image Stored in ChromeStorage")}function errorHandler(e){localStorage.FileSystemAccess=0;var t="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:t="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:t="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:t="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:t="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:t="INVALID_STATE_ERR";break;default:t="Unknown Error"}console.log("Error: "+t)}function init(){if(console.log("init"),!localStorage.FileSystemAccess){navigator.webkitPersistentStorage.requestQuota(293601280,function(e){window.webkitRequestFileSystem(PERSISTENT,e,function(e){window.file_system=e,console.log("Opened file system Name: "+e.name),console.log("Opened file system: "+e),localStorage.FileSystemAccess=1,console.log("Inside:"+window.file_system)},errorHandler)},function(e){console.log("User Canceled Error",e),localStorage.FileSystemAccess=2})}console.log(window.file_system)}!function(){var e=this,t=function(t,o){var a=t.split("."),n=window||e;a[0]in n||!n.execScript||n.execScript("var "+a[0]);for(var i;a.length&&(i=a.shift());)a.length||void 0===o?n=n[i]?n[i]:n[i]={}:n[i]=o},o=function(e){var t=chrome.runtime.connect("nmmhkkegccagdldgiimedpiccmgmieda",{}),o=!1;t.onMessage.addListener(function(t){o=!0,"response"in t&&!("errorType"in t.response)?e.success&&e.success(t):e.failure&&e.failure(t)}),t.onDisconnect.addListener(function(){!o&&e.failure&&e.failure({request:{},response:{errorType:"INTERNAL_SERVER_ERROR"}})}),t.postMessage(e)};t("google.payments.inapp.buy",function(e){e.method="buy",o(e)}),t("google.payments.inapp.consumePurchase",function(e){e.method="consumePurchase",o(e)}),t("google.payments.inapp.getPurchases",function(e){e.method="getPurchases",o(e)}),t("google.payments.inapp.getSkuDetails",function(e){e.method="getSkuDetails",o(e)})}();var _AnalyticsCode="UA-46608030-4",_gaq=_gaq||[];_gaq.push(["_setAccount",_AnalyticsCode]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),$(document).on("click","[data-aid]",function(){_gaq.push(["_trackEvent",$(this).data("aid"),"clicked"])}),Authentication={SERVER_URL:"https://limitless-py.appspot.com/",init:function(){$("body").on("click",".authenticateButton",function(){var e=$(this).data("place");$(this).text("Logging In..."),Authentication.authenticate(e)}),$("body").on("click",".logoutButton",function(){Authentication.logout()})},authenticate:function(e){var t=Util.getGuid();chrome.identity.launchWebAuthFlow({url:Authentication.SERVER_URL+"login?identifier="+t,interactive:!0},function(t){Authentication.done(t,e)})},done:function(e,t){if(!e||e&&-1==e.indexOf("chromiumapp.org"))return void Authentication.afterLogin({success:!1,loginPlace:t});var o=Util.getGuid(),a={identifier:o};$.ajax({type:"POST",url:Authentication.SERVER_URL+"get_token",data:JSON.stringify(a),success:function(e){var o=e.result;if(o){var a=JSON.parse(localStorage.metadata),n=JSON.parse(localStorage.privatedata);a.loggedIn=!0,n.name=o.name,n.email=o.email,n.picture=o.picture,localStorage.privatedata=JSON.stringify(n),localStorage.metadata=JSON.stringify(a),localStorage.authdata=JSON.stringify(o),Authentication.afterLogin({success:!0,loginPlace:t})}},contentType:"application/json",dataType:"json"})},afterLogin:function(e){Authentication.handleLoginViews(),$(".authenticateButton").text("Login with Google"),"loginFlow"==e.loginPlace?setupHome():"homeScreen"==e.loginPlace&&e.success&&($(".authenticateButton").text("Login"),$(".loginSuccessOneTimeMessage").show())},handleLoginViews:function(){var e=JSON.parse(localStorage.privatedata),t=JSON.parse(localStorage.metadata);$.each($(".authContainer"),function(o,a){t.loggedIn?($(a).find(".loggedInName").text(e.name),$(a).find(".profilePicUrlImg").attr("src",e.picture),$(a).find(".loginLinkContainer").hide(),$(a).find(".logoutLinkContainer").show()):($(a).find(".logoutLinkContainer").hide(),$(a).find(".loginLinkContainer").show(),$(".loginSuccessOneTimeMessage").hide())})},logged_in:function(){return JSON.parse(localStorage.metadata).loggedIn||!1},logout:function(){var e=JSON.parse(localStorage.metadata);e.loggedIn=!1,localStorage.metadata=JSON.stringify(e),localStorage.authdata=null,Authentication.handleLoginViews()}},Emails={host:"https://limitless-py.appspot.com",init:function(){$(document).on("click","#emailSendButton",function(e){e.preventDefault(),Emails.send($(this))}),$(document).on("click",".toggleDownLink",function(e){e.preventDefault(),Emails.toggleDropdown($(this))})},send:function(e){var t=$("#composeEmailForm input[name='to']").val(),o=$("#composeEmailForm input[name='cc']").val(),a=$("#composeEmailForm input[name='bcc']").val();""==t&&""==o&&""==a&&(t=JSON.parse(localStorage.privatedata).email);var n=$("#composeEmailForm input[name='subject']").val();""==n&&(n="Limitless Notepad");var i=$("#composeEmailForm textarea[name='body']").val();if(""!=i){var r=JSON.parse(localStorage.metadata).guid,s={to:t,cc:o,bcc:a,subject:n,text:i,identifier:r};e.text("Sending..."),$.ajax({type:"POST",url:Emails.host+"/msg",data:JSON.stringify(s),success:function(o){e.text("Send"),$("#composeEmailForm").find("input, textarea").val(""),t==JSON.parse(localStorage.privatedata).email?Emails.showMessage("Email sent to self!"):Emails.showMessage("Email sent successfully!")},contentType:"application/json",dataType:"json"})}},showMessage:function(e){$(".emailSuccessMessage").text(e),setTimeout(function(){$(".emailSuccessMessage").text("")},5e3)},toggleDropdown:function(e){e.hasClass("active")?($(".ccBccContainer").find("label").hide(),$(".ccBccContainer").slideUp(),$(e).removeClass("active"),$(e).find(".glyphicon").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down")):($(".ccBccContainer").find("label").hide(),$(".ccBccContainer").slideDown(function(){$(".ccBccContainer").find("label").show()}),$(e).addClass("active"),$(e).find(".glyphicon").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"))}},TopSiteAnalytics={DEFAULT_TOP_SITES:[["google.com",0],["wikipedia.org",0],["quora.com",0],["lumosity.com",0],["coursera.org",0],["gmail.com",0],["lifehacker.com",0],["ted.com",0]],show:function(){$(".notepad-icon li:not(#notepadLi)").remove();var e=Stats.getWeeklyTopSites();e.length<8&&$.each(TopSiteAnalytics.DEFAULT_TOP_SITES.slice(0,8-e.length),function(t,o){e.push(o)}),$.each(e,function(e,t){var o=$("#topSiteLiTemplate li").clone();o.find(".site-link").attr("href","http://"+t[0]),o.find(".site-link").parent("div").attr("title","http://"+t[0]),o.find(".site-initials").text(t[0].substr(0,2).toUpperCase()),o.find(".site-duration").text(formatTime(t[1])),e<4?$("#notepadLi").before(o):$(".notepad-icon").append(o)}),$("#bottomInfoAction").show()},hide:function(){$("#bottomInfoAction").hide()}},Analytics={activeTab:"TODAY",init:function(){Analytics.activeTab="Today",$("#detailedstats").click(function(){Analytics.showCategoryAnalytics(),hideallscreens(),ScreenOverlay.setAsContentScreen(),$("#analyticsscreen").show(),$("#analyticsOverviewPage").show(),$("#analyticsDetailsPage").hide()}),$("#detailScreenBackButton").click(function(e){e.preventDefault(),Analytics.showCategoryAnalytics(),$("#analyticsscreen").show(),$("#analyticsDetailsPage").hide(),$("#analyticsOverviewPage").show()}),$(document).on("click",".analyticsTab",function(e){e.preventDefault(),$(".analyticsTab").removeClass("active"),$(this).addClass("active"),Analytics.activeTab=$(this).find("a").text(),Analytics.showCategoryAnalytics()}),$(document).on("click",".categoryStatDetailsLink",function(e){e.preventDefault();var t=$(this).data("category");Analytics.setupDetailsPage(t),hideallscreens(),ScreenOverlay.setAsContentScreen(),$("#analyticsscreen").show(),$("#analyticsOverviewPage").hide(),$("#analyticsDetailsPage").show()}),$(document).on("click","#emailComposeIcon",function(e){e.preventDefault(),showEmailCompose()})},showWeeklyPage:function(){$("#detailedstats").click(),$("a[href='#weekly']").click()},showCategoryAnalytics:function(){var e=[];switch($(".category-list").html(""),Analytics.activeTab){case"Today":e=[(new Date).toDateString()];break;case"Weekly":e=Util.getPastDays(7);break;case"Monthly":e=Util.getPastDays(30);break;case"Yearly":e=Util.getPastDays(365);break;case"Overall":e=["all"]}if(-1==["Weekly","Monthly","Yearly"].indexOf(Analytics.activeTab)){$("#premiumNeededMsgContainer").hide();var t=Stats.getCategoriesDuration(e);Analytics.showCategoryTiles(t)}else $("#emailDurationContainer").html("--"),$("#socialDurationContainer").html("--"),$("#totalDurationContainer").html("--"),Premium.canUse("productivityreports",function(t){var o=Stats.getCategoriesDuration(e);Analytics.showCategoryTiles(o)},function(e){-1!=["Weekly","Monthly","Yearly"].indexOf(Analytics.activeTab)&&$("#premiumNeededMsgContainer").show()})},showCategoryTiles:function(e){var t=e.categoryDurations,o=0,a=[];for(key in t)a.push([key,t[key]]);a.sort(function(e,t){return t[1]-e[1]}),$.each(a,function(e,t){if(-1!=["Social","Email"].indexOf(t[0]))return!0;var a=$("#categoryTileTemplate div:first").clone();a.find("#categoryNameContainer").html(t[0]),a.find("#categoryDuration").html(formatTime(t[1])),a.find(".categoryStatDetailsLink").attr("data-category",t[0]),$(".category-list-"+parseInt(o/4)).append(a),o+=1}),$("#emailDurationContainer").html(formatTime(t.Email||0)),$("#socialDurationContainer").html(formatTime(t.Social||0)),$("#totalDurationContainer").html(formatTime(e.totalDuration))},setupDetailsPage:function(e){var t=Stats.getTodaysTopSitesFor(e),o=t.topSites;$("#siteListTable tbody tr").remove(),$.each(o,function(e,o){var a=$("#detailTableRowTemplate tr").clone();a.find("#siteNameContainer").html(o[0]),a.find("#siteDurationContainer").html(formatTime(o[1]||0)),a.find("#sitePercentageContainer").html((o[1]/t.totalTime*100).toFixed(2)),$("#siteListTable tbody").append(a)}),$("#nameOfCategory").html(e),$("#categoryDurationContainer").html(formatTime(t.totalTime))}};var ScreenOverlay={setAsContentScreen:function(){$("#overlayContainer").addClass("content-overlay")},setAsImageScreen:function(){$("#overlayContainer").removeClass("content-overlay")}};Stats={getCategoriesDuration:function(e){e=e?0==e.length?[(new Date).toDateString()]:e:[(new Date).toDateString()];var t=getDontTrackArr(),o=JSON.parse(localStorage.timeanalytics),a={},n=0;for(var i in o)if(!t[i]&&"newtab"!=i){var r=o[i].category.split(",");for(key in o[i])if(-1==["productive","category"].indexOf(key)){if(-1!=e.indexOf("all"));else if(-1==e.indexOf(key))continue;if(o[i][key]){o[i][key]=parseInt(o[i][key]);var s=0;s=o[i][key],n+=s;for(var c=0;c<r.length;c++){var l=r[c].trim();a[l]?a[l]+=s:a[l]=s}}}}return{categoryDurations:a,totalDuration:n}},getWeeklyTopSites:function(){var e=Util.getPastDays(7),t=[],o=getDontTrackArr(),a=JSON.parse(localStorage.timeanalytics);for(var n in a)if(!o[n]&&"newtab"!=n){var i=0;$.each(e,function(e,t){if(!a[n][t])return!0;i+=parseInt(a[n][t])}),t.push([n,i])}return t.sort(function(e,t){return t[1]-e[1]}),t.slice(0,8)},getTodaysTopSitesFor:function(e){var t=(new Date).toDateString(),o=[],a=0,n=getDontTrackArr(),i=JSON.parse(localStorage.timeanalytics);for(var r in i)n[r]||"newtab"!=r&&i[r][t]&&i[r].category&&-1!=i[r].category.indexOf(e)&&(a+=parseInt(i[r][t]),o.push([r,parseInt(i[r][t])]));return o.sort(function(e,t){return t[1]-e[1]}),{topSites:o.slice(0,10),totalTime:a}},getCategoryFromRandomTopTen:function(){var e=Stats.getCategoriesDuration(),t=[];for(key in e.categoryDurations)0!=e.categoryDurations[key]&&t.push([key,e.categoryDurations[key]]);t.sort(function(e,t){return t[1]-e[1]}),t=t.slice(0,10);var o=t[Math.floor(Math.random()*t.length)];return(!o||o&&0==o.length)&&(o=[["Social",0]]),{name:o[0],duration:o[1]}}},Util={NUMBER_OF_WALLPAPERS:30,NATURE_WALLPAPERS_ONLINE:100,TRIGGER_WALLPAPERS_ONLINE:5,secondsRemainingInDay:function(){var e=new Date;return 86400-60*e.getHours()*60-60*e.getMinutes()-e.getSeconds()},dayOfYear:function(){var e=new Date,t=new Date(e.getFullYear(),0,0),o=e-t;return Math.floor(o/864e5)},getPastDays:function(e){var t=new Date,o=[];for(o.push(t.toDateString()),i=0;i<e-1;i++)t.setDate(t.getDate()-1),o.push(t.toDateString());return o},setNewWallpaper:function(e){"remaining_time"!=e&&"goal"!=e&&"login_google"!=e&&"review_app"!=e||(e="nature");var t=Util.dayOfYear();chrome.storage.local.get(e,function(o){console.log("Loading Inbuilt Image"),"nature"!=e?$("body").css("background-image","url(images/Trigger/"+e+".jpg)"):$("body").css("background-image","url(images/Nature/nature"+myRandom(t,e,!1)+".jpg)")})},getGuid:function(){return JSON.parse(localStorage.metadata).guid}},window.file_system="";var Premium={init:function(){$("#productivityreportsPurchaseButton").click(function(e){e.preventDefault(),Premium.purchaseProductivityReports()})},canUse:function(e,t,o){google.payments.inapp.getPurchases({parameters:{env:"prod"},success:function(a){var n=!1;$.each(a.response.details,function(o,i){"chromewebstore#payment"==i.kind&&i.sku==e&&(n=!0,t(a))}),n||o(a)},failure:function(t){t.details&&!t.details.indexOf(e)||o(t)}})},purchaseProductivityReports:function(){google.payments.inapp.buy({parameters:{env:"prod"},sku:"productivityreports",success:function(e){localStorage.productivityreports=JSON.stringify(e)},failure:function(e){localStorage.productivityreports=JSON.stringify(e)}})}},ToDo={init:function(){ToDo.displayTodos(),ToDo.toggleView(),$(".dropdown").on("show.bs.dropdown",function(){ToDo.setShow()}),$(".dropdown").on("hide.bs.dropdown",function(){ToDo.setHide()}),$("#todoForm").submit(function(e){e.preventDefault(),ToDo.addTodo()}),$(".todo-icon").on("click",".todo-completed-checkbox",function(){return ToDo.removeTodo($(this)),!1}),$(".todo-icon").on("click",".todo-text",function(e){return e.preventDefault(),ToDo.editTodo($(this)),!1})},displayTodos:function(){var e=JSON.parse(localStorage.todos||"{}");$("#todosList li").slice(1).remove();for(var t in e)ToDo.displayTodo(t,e[t])},displayTodo:function(e,t){var o=$($("#todoTemplateHtml").html()).clone();o.find(".todo-text").text(e),t&&t.done?($(o).addClass("completed"),$("#todosList li:last").after(o)):$("#todosList li:first").after(o)},addTodo:function(){var e=$("#todoInput").val(),t=JSON.parse(localStorage.todos||"{}");t[e]||(t[e]={},localStorage.todos=JSON.stringify(t),ToDo.displayTodo(e),$("#todoForm input").val(""))},removeTodo:function(e){var t=e.closest("li").find(".todo-text").text();ToDo.markDone(t),ToDo.displayTodos()},editTodo:function(e){var t=$(e).text();$("#todoInput").val(t),$("#todoInput").focus(),ToDo.deleteTodo(t),$(e).closest("li").remove()},markDone:function(e){var t=JSON.parse(localStorage.todos||"{}");t[e]&&(t[e]={done:!0},t=ToDo.removeDoneExceptRecent(t),localStorage.todos=JSON.stringify(t))},deleteTodo:function(e){var t=JSON.parse(localStorage.todos||"{}");delete t[e],localStorage.todos=JSON.stringify(t)},removeDoneExceptRecent:function(e){doneTasks=[];for(var t in e)e[t].done&&doneTasks.push(t)
;return doneTasks.length>3&&$.each(doneTasks.reverse(),function(t,o){t>2&&delete e[o]}),e},setShow:function(){localStorage.showTodos="true"},setHide:function(){localStorage.showTodos="false"},toggleView:function(){localStorage.showTodos&&"true"==localStorage.showTodos&&localStorage.todos.length>2&&$("#todoToggle").dropdown("toggle")}};