function getSiteFromUrl(t){var e=t.match(siteRegexp),a=e[1].replace(/.*?:\/\//g,"");return a=a.replace("www.","")}function setupcategories(){$("#stats").empty();var t=0,e=[],a=0;donttrack=getDontTrackArr(),timeanalytics=JSON.parse(localStorage.timeanalytics),1==timeanalytics[url].productive?$("#productivity").prop("checked",!0):$("#productivity").prop("checked",!1),$("#categories").val(timeanalytics[url].category);for(var r in timeanalytics)if(!donttrack[r]){var i=timeanalytics[r].category.split(",");if(timeanalytics[r][dateString]){timeanalytics[r][dateString]=parseInt(timeanalytics[r][dateString]);var c=0;c=timeanalytics[r][dateString],t+=c;for(var l=0;l<i.length;l++){var n=i[l].trim();e[n]?e[n]+=c:e[n]=c}1==parseInt(timeanalytics[r].productive)&&(a+=timeanalytics[r][dateString])}}var o=[];for(var n in e)o.push([n,e[n]]);o.sort(function(t,e){return t=t[1],e=e[1],t>e?-1:t<e?1:0});var d=document.getElementById("stats"),s=document.createElement("thead");d.appendChild(s),m=document.createElement("tr"),th=document.createElement("th"),th.innerHTML="Category",m.appendChild(th),th=document.createElement("th"),th.innerHTML="Time Spent",m.appendChild(th),th=document.createElement("th"),th.innerHTML="% of total",m.appendChild(th),s.appendChild(m),tbody=document.createElement("tbody"),d.appendChild(tbody);for(var m,u=0;u<o.length;u++){var n=o[u][0];m=document.createElement("tr"),cell=document.createElement("td"),cell.appendChild(document.createTextNode(n)),m.appendChild(cell),cell=document.createElement("td"),cell.appendChild(document.createTextNode(formatTime(o[u][1]))),m.appendChild(cell);var p=Math.floor(100*o[u][1]/t);cell=document.createElement("td"),cell.appendChild(document.createTextNode(p+"%")),m.appendChild(cell),tbody.appendChild(m)}var h=Math.floor(100*a/t),g="Total time spent on the browser today: <b>"+formatTime(t)+"</b>. <br>Productive: <b>"+h+"%</b>";g+="<br>Time spent on <b>"+url+"</b> today: <b>"+formatTime(timeanalytics[url][dateString])+"</b>",$("#total-time").html(formatTime(t));var y=url;url.length>20&&(y=url.substring(0,20)+"..."),$("#sitename").html(capitaliseFirstLetter(y)),$("#productive").html(h+"%"),donttrack[url]?($("#timespent").html("Not Tracked"),$("#track").prop("checked",!1)):($("#timespent").html("Time spent: "+formatTime(timeanalytics[url][dateString])),$("#track").prop("checked",!0)),$("#wildcardcheck").html(" Apply the same settings to all *."+superdomain),$("#trackcheck").html(" Track "+y),h>60?$("#productive").css("color","green"):h<40?$("#productive").css("color","red"):$("#productive").css("color","orange"),$("#stats tr:even").css("background-color","#fff")}function initialize(){$("#morestats").html('<a href="'+chrome.extension.getURL("tabpage.html")+'" target="_blank">More Stats</a>'),1==localStorage.paused?$("#pause").html("Unpause"):$("#pause").html("Pause for 30 min"),$("#pause").click(function(){1==localStorage.paused?(localStorage.paused=0,localStorage.pausetime=0,$("#pause").html("Pause for 30 min")):(localStorage.pausetime=today.getTime()/1e3,localStorage.paused=1,$("#pause").html("Unpause"),setBadge(null,"")),setupcategories()}),$("#update").click(function(){$("#productivity").is(":checked")?(timeanalytics[url].productive=1,setBadge([0,255,0,255],null)):(timeanalytics[url].productive=0,setBadge([255,0,0,255],null)),""!==$("#categories").val()&&(timeanalytics[url].category=capitaliseFirstLetter($("#categories").val())),0==$("#track").is(":checked")?addDonttrack(url,1):$("#track").is(":checked")&&1==donttrack[url]&&removeDonttrack(url),$("#wildcard").is(":checked")&&(addWildcard(superdomain,timeanalytics[url].productive,timeanalytics[url].category,donttrack[url]),timeanalytics=JSON.parse(localStorage.timeanalytics)),localStorage.timeanalytics=JSON.stringify(timeanalytics),setupcategories()}),setupcategories();var t=document.getElementById("stats");1==t.childNodes.length&&t.removeChild(t.childNodes[0])}var today=new Date,hour=Number(today.getHours()),dateString=today.toDateString(),siteRegexp=/^(\w+:\/\/[^\/]+).*$/,timeanalytics,url="",dontttack,superdomain="";document.addEventListener("DOMContentLoaded",function(){chrome.tabs.query({currentWindow:!0,active:!0},function(t){url=getSiteFromUrl(t[0].url),superdomain=getSuperdomainFull(t[0].url),initialize()})});